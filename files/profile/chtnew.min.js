function pingpoliCandlestick(t,i,s,e,o){this.timestamp=parseInt(t),this.open=parseFloat(i),this.high=parseFloat(s),this.low=parseFloat(e),this.close=parseFloat(o)}function pingpoliCandlestickChart(t,i){if(this.options=void 0!==i?i:{},this.options.hasOwnProperty("disableGrid")||(this.options.disableGrid=!1),this.options.hasOwnProperty("disableLegend")||(this.options.disableLegend=!1),this.options.hasOwnProperty("disableLowHighPriceDisplay")||(this.options.disableLowHighPriceDisplay=!1),this.options.hasOwnProperty("disableCrosshair")||(this.options.disableCrosshair=!1),this.options.hasOwnProperty("disableCurrentMarketPrice")||(this.options.disableCurrentMarketPrice=!1),this.options.hasOwnProperty("disablePanningAcceleration")||(this.options.disablePanningAcceleration=!1),this.options.hasOwnProperty("allowOverPanning")||(this.options.allowOverPanning=!1),this.options.hasOwnProperty("overlayShowTime")||(this.options.overlayShowTime=!0),this.options.hasOwnProperty("overlayShowData")||(this.options.overlayShowData=!0),this.options.hasOwnProperty("overlayShowChange")||(this.options.overlayShowChange=!0),this.options.hasOwnProperty("overlayMode")||(this.options.overlayMode="hover"),this.ticker="",this.canvas=document.getElementById(t),this.devicePixelRatio=window.devicePixelRatio||1,this.options.hasOwnProperty("fillWidth")&&!0===this.options.fillWidth){var s=this.canvas.parentElement;this.canvas.width=s.getBoundingClientRect().width*this.devicePixelRatio,this.width=parseInt(s.getBoundingClientRect().width),this.canvas.style.width=s.getBoundingClientRect().width+"px"}else this.width=parseInt(this.canvas.width);if(this.options.hasOwnProperty("fillHeight")&&!0===this.options.fillHeight){s=this.canvas.parentElement;this.canvas.height=s.getBoundingClientRect().height*this.devicePixelRatio,this.height=parseInt(s.getBoundingClientRect().height),this.canvas.style.height=s.getBoundingClientRect().height+"px"}else this.height=parseInt(this.canvas.height);if(this.context=this.canvas.getContext("2d"),this.context.scale(this.devicePixelRatio,this.devicePixelRatio),this.options.hasOwnProperty("fillWidth")&&!0===this.options.fillWidth||this.options.hasOwnProperty("fillHeight")&&!0===this.options.fillHeight){const t=new ResizeObserver((t=>{for(let i of t)if(i.contentBoxSize){const t=Array.isArray(i.contentBoxSize)?i.contentBoxSize[0]:i.contentBoxSize;this.options.hasOwnProperty("fillWidth")&&!0===this.options.fillWidth&&(this.canvas.width=t.inlineSize*this.devicePixelRatio,this.width=parseInt(t.inlineSize),this.xPixelRange=this.width-this.marginLeft-this.marginRight,this.canvas.style.width=t.inlineSize+"px"),this.options.hasOwnProperty("fillHeight")&&!0===this.options.fillHeight&&(this.canvas.height=t.blockSize*this.devicePixelRatio,this.height=parseInt(t.blockSize),this.yPixelRange=this.height-this.marginTop-this.marginBottom,this.canvas.style.height=t.blockSize+"px"),this.context=this.canvas.getContext("2d"),this.context.scale(this.devicePixelRatio,this.devicePixelRatio),this.draw()}}));s=this.canvas.parentElement;t.observe(s)}this.canvas.addEventListener("mousemove",(t=>{this.mouseMove(t)})),this.canvas.addEventListener("mouseout",(t=>{this.mouseOut(t)})),this.canvas.addEventListener("wheel",(t=>{this.scroll(t),t.preventDefault()})),this.canvas.addEventListener("pointerdown",(t=>{this.b_dragging=!0,this.mouseDragStartX=t.offsetX,this.mouseDragStartY=t.offsetY,t.b_hasBeenMoved=!1,t.totalMovement=0,this.evCache.push(t)})),this.canvas.addEventListener("pointermove",(t=>{this.pointerMoveEvent(t)})),this.canvas.addEventListener("pointerup",(t=>{this.pointerUpEvent(t,!0)})),this.canvas.addEventListener("pointercancel",(t=>{this.pointerUpEvent(t,!1)})),this.canvas.addEventListener("pointerout",(t=>{this.pointerUpEvent(t,!1)})),this.canvas.addEventListener("pointerleave",(t=>{this.pointerUpEvent(t,!1)})),this.evCache=new Array,this.prevDiff=-1,this.b_dragging=!1,this.mouseDragStartX=0,this.mouseDragStartY=0,this.scrollOffsetX=0,this.scrollOffsetXCounter=0,this.options&&this.options.hasOwnProperty("backgroundColor")?this.canvas.style.backgroundColor=this.options.backgroundColor:this.canvas.style.backgroundColor="#252525",this.options.hasOwnProperty("fontSize")||(this.options.fontSize=12),this.options.hasOwnProperty("font")||(this.options.font="sans-serif"),this.options&&this.options.hasOwnProperty("gridColor")?this.gridColor=this.options.gridColor:this.gridColor="#444444",this.options&&this.options.hasOwnProperty("gridTextColor")?this.gridTextColor=this.options.gridTextColor:this.gridTextColor="#aaaaaa",this.options&&this.options.hasOwnProperty("overlayBackgroundColor")?this.overlayBackgroundColor=this.options.overlayBackgroundColor:this.overlayBackgroundColor="#eeeeee",this.options&&this.options.hasOwnProperty("overlayTextColor")?this.overlayTextColor=this.options.overlayTextColor:this.overlayTextColor="#000000",this.options&&this.options.hasOwnProperty("greenColor")?this.greenColor=this.options.greenColor:this.greenColor="#00cc00",this.options&&this.options.hasOwnProperty("redColor")?this.redColor=this.options.redColor:this.redColor="#cc0000",this.options&&this.options.hasOwnProperty("greenHoverColor")?this.greenHoverColor=this.options.greenHoverColor:this.greenHoverColor="#00ff00",this.options&&this.options.hasOwnProperty("redHoverColor")?this.redHoverColor=this.options.redHoverColor:this.redHoverColor="#ff0000",this.options.hasOwnProperty("wickWidth")||(this.options.wickWidth=1),this.options.hasOwnProperty("wickGreenColor")||(this.options.wickGreenColor=this.greenColor),this.options.hasOwnProperty("wickRedColor")||(this.options.wickRedColor=this.redColor),this.options.hasOwnProperty("crosshairColor")||(this.options.crosshairColor="#eeeeee"),this.options.hasOwnProperty("crosshairTextColor")||(this.options.crosshairTextColor="#000000"),this.options.hasOwnProperty("crosshairLineStyle")||(this.options.crosshairLineStyle="dashed"),this.options.hasOwnProperty("candleBorderWidth")||(this.options.candleBorderWidth=0),this.options.hasOwnProperty("watermarkImage")||(this.options.watermarkImage=""),this.watermarkImage=null,this.b_watermarkImageLoaded=!1,""!==this.options.watermarkImage&&(this.watermarkImage=new Image,this.watermarkImage.src=this.options.watermarkImage,this.watermarkImage.onload=()=>{this.b_watermarkImageLoaded=!0}),this.context.lineWidth=1,this.candleWidth=5,this.options&&this.options.hasOwnProperty("marginLeft")?this.marginLeft=parseInt(this.options.marginLeft):this.marginLeft=10,this.options&&this.options.hasOwnProperty("marginRight")?this.marginRight=parseInt(this.options.marginRight):this.marginRight=100,this.options&&this.options.hasOwnProperty("marginTop")?this.marginTop=parseInt(this.options.marginTop):this.marginTop=20,this.options&&this.options.hasOwnProperty("marginBottom")?this.marginBottom=parseInt(this.options.marginBottom):this.marginBottom=50,this.options.hasOwnProperty("scrollZoomSensitivity")?this.scrollZoomSensitivity=this.options.scrollZoomSensitivity:this.scrollZoomSensitivity=20,this.options.hasOwnProperty("touchZoomSensitivity")?this.touchZoomSensitivity=this.options.touchZoomSensitivity:this.touchZoomSensitivity=50,this.options.hasOwnProperty("panningSensitivity")?this.panningSensitivity=this.options.panningSensitivity:this.panningSensitivity=500,this.yStart=0,this.yEnd=0,this.yRange=0,this.yPixelRange=this.height-this.marginTop-this.marginBottom,this.yStartIndex=0,this.yEndIndex=0,this.xStart=0,this.xEnd=0,this.xRange=0,this.xPixelRange=this.width-this.marginLeft-this.marginRight,this.options.hasOwnProperty("xGridCells")?this.xGridCells=this.options.xGridCells:this.xGridCells=16,this.options.hasOwnProperty("yGridCells")?this.yGridCells=this.options.yGridCells:this.yGridCells=16,this.options.hasOwnProperty("gridLineStyle")||(this.options.gridLineStyle="dotted"),this.b_drawMouseOverlay=!1,this.mousePosition={x:0,y:0},this.xMouseHover=0,this.yMouseHover=0,this.hoveredCandlestickID=0,this.b_moveOverlay=!1,this.b_pinchZooming=!1,this.panningDeltaX=0,this.options.hasOwnProperty("panningAccelerationDamping")?this.panningAccelerationDamping=this.options.panningAccelerationDamping:this.panningAccelerationDamping=.975,this.panningAtStartCallback=()=>{},this.panningAtStartCooldown=0,this.panningAtEndCallback=()=>{},this.panningAtEndCooldown=0,this.options.hasOwnProperty("marketPriceLineColor")||(this.options.marketPriceLineColor="#777777"),this.options.hasOwnProperty("marketPriceTextColor")||(this.options.marketPriceTextColor="#ffffff"),this.marketPriceRect={x:0,y:0,width:0,height:0,b_clickable:!1},this.b_firstDraw=!0,this.zoomStartID=0,this.candlesticks=[]}var _candlestickStream;pingpoliCandlestick.prototype.update=function(t,i,s,e){this.open=parseFloat(t),this.high=parseFloat(i),this.low=parseFloat(s),this.close=parseFloat(e)},pingpoliCandlestickChart.prototype.setTicker=function(t){this.ticker=t},pingpoliCandlestickChart.prototype.clear=function(){this.b_drawMouseOverlay=!1,this.mousePosition={x:0,y:0},this.xMouseHover=0,this.yMouseHover=0,this.hoveredCandlestickID=0,this.b_moveOverlay=!1,this.b_pinchZooming=!1,this.panningAtStartCooldown=0,this.panningAtEndCooldown=0,this.b_firstDraw=!0,this.zoomStartID=0,this.yStart=0,this.yEnd=0,this.yRange=0,this.yStartIndex=0,this.yEndIndex=0,this.xStart=0,this.xEnd=0,this.xRange=0,this.candlesticks=[],this.draw()},pingpoliCandlestickChart.prototype.addCandlestick=function(t,i,s,e,o){if(!isNaN(t)&&!(isNaN(i)||isNaN(s)||isNaN(e)||isNaN(o))){var h=new pingpoliCandlestick(t,i,s,e,o);if(!(h.low>h.high)){for(let t=0;t<this.candlesticks.length;++t)if(this.candlesticks[t].timestamp==h.timestamp)return;this.candlesticks.length>0&&(h.timestamp<this.candlesticks[0].timestamp&&this.zoomStartID++,h.timestamp>this.candlesticks[this.candlesticks.length-1].timestamp&&(this.zoomStartID++,this.zoomStartID>this.candlesticks.length-50&&(this.zoomStartID=this.candlesticks.length-50),this.zoomStartID+this.scrollOffsetX<0&&(this.scrollOffsetX=-this.zoomStartID,this.scrollOffsetXCounter=-this.zoomStartID))),this.candlesticks.push(h),this.candlesticks.sort(((t,i)=>t.timestamp<i.timestamp?-1:t.timestamp>i.timestamp?1:0))}}},pingpoliCandlestickChart.prototype.updateCandlestick=function(t,i,s,e,o){if(0!=this.candlesticks.length){var h=this.candlesticks[this.candlesticks.length-1];h.timestamp==t?h.update(i,s,e,o):(this.addCandlestick(t,i,s,e,o),this.candlesticks.shift()),this.draw()}},pingpoliCandlestickChart.prototype.mouseMove=function(t){0!=this.candlesticks.length&&"hover"===this.options.overlayMode&&this.updateOverlay(t)},pingpoliCandlestickChart.prototype.mouseOut=function(t){"hover"===this.options.overlayMode&&(this.b_drawMouseOverlay=!1,this.draw())},pingpoliCandlestickChart.prototype.scroll=function(t){var i=this.candlesticks.length-this.zoomStartID;t.deltaY<0?this.candlesticks.length>50&&(this.zoomStartID+=i/this.scrollZoomSensitivity,this.zoomStartID=Math.floor(this.zoomStartID),this.zoomStartID>this.candlesticks.length-50&&(this.zoomStartID=this.candlesticks.length-50)):(this.zoomStartID-=i/this.scrollZoomSensitivity,this.zoomStartID=Math.floor(this.zoomStartID),this.zoomStartID<0&&(this.zoomStartID=0)),this.limitScrollOffset(),"hover"===this.options.overlayMode?this.updateOverlay(t):"click"===this.options.overlayMode&&this.b_drawMouseOverlay?this.moveOverlay(t):this.draw()},pingpoliCandlestickChart.prototype.pointerMoveEvent=function(t){for(var i=0;i<this.evCache.length;i++)if(t.pointerId==this.evCache[i].pointerId){var s=this.evCache[i].totalMovement,e=Math.abs(this.evCache[i].clientX-t.clientX),o=Math.abs(this.evCache[i].clientY-t.clientY);this.evCache[i]=t,this.evCache[i].b_hasBeenMoved=!0;var h=Math.sqrt(e*e+o*o);this.evCache[i].totalMovement=s+h;break}if(2==this.evCache.length){var n=Math.abs(this.evCache[0].clientX-this.evCache[1].clientX);if(this.prevDiff>0){var a=this.candlesticks.length-this.zoomStartID;n>this.prevDiff&&(this.candlesticks.length>50&&(this.zoomStartID+=a/this.touchZoomSensitivity,this.zoomStartID=Math.floor(this.zoomStartID),this.zoomStartID>this.candlesticks.length-50&&(this.zoomStartID=this.candlesticks.length-50)),this.limitScrollOffset(),"click"===this.options.overlayMode&&this.b_drawMouseOverlay&&this.moveOverlay(t),this.draw()),n<this.prevDiff&&(this.zoomStartID-=a/this.touchZoomSensitivity,this.zoomStartID=Math.floor(this.zoomStartID),this.zoomStartID<0&&(this.zoomStartID=0),this.limitScrollOffset(),"click"===this.options.overlayMode&&this.b_drawMouseOverlay&&this.moveOverlay(t),this.draw())}return this.prevDiff=n,this.b_pinchZooming=!0,t.preventDefault(),void t.stopPropagation()}if(1==this.evCache.length){if(this.b_pinchZooming)return t.preventDefault(),void t.stopPropagation();if("click"===this.options.overlayMode&&this.b_drawMouseOverlay)return void(this.evCache[i].totalMovement>10&&this.updateOverlay(t));if(this.candlesticks.length>1){var r=this.xToPixelCoords(this.candlesticks[1].timestamp)-this.xToPixelCoords(this.candlesticks[0].timestamp);this.panningDeltaX=Math.floor(t.offsetX-this.mouseDragStartX),this.scrollOffsetXCounter-=this.panningDeltaX/r,this.scrollOffsetX=Math.floor(this.scrollOffsetXCounter),this.mouseDragStartX=t.offsetX,this.limitScrollOffset(),this.draw()}return t.preventDefault(),void t.stopPropagation()}},pingpoliCandlestickChart.prototype.pointerUpEvent=function(t,i){for(var s=0;s<this.evCache.length;s++)if(this.evCache[s].pointerId==t.pointerId){(!this.evCache[s].b_hasBeenMoved||this.evCache[s].totalMovement<20)&&this.click(t),this.evCache.splice(s,1);break}if(this.evCache.length<2&&(this.prevDiff=-1),0==this.evCache.length){if(i&&!1===this.b_pinchZooming&&!1===this.options.disablePanningAcceleration&&Math.abs(this.panningDeltaX)>1){var e=this.candlesticks.length-this.zoomStartID;this.scrollOffsetXCounter-=this.panningDeltaX*(e/this.panningSensitivity),this.scrollOffsetX=Math.floor(this.scrollOffsetXCounter),this.limitScrollOffset(),this.draw(),setTimeout((()=>{this.panningAccelerationLoop()}),20)}this.b_dragging=!1,this.b_pinchZooming=!1}t.preventDefault(),t.stopPropagation()},pingpoliCandlestickChart.prototype.panningAccelerationLoop=function(){this.panningDeltaX*=this.panningAccelerationDamping;var t=this.candlesticks.length-this.zoomStartID;this.scrollOffsetXCounter-=this.panningDeltaX*(t/this.panningSensitivity),this.scrollOffsetX=Math.floor(this.scrollOffsetXCounter),this.limitScrollOffset(),this.draw(),Math.abs(this.panningDeltaX)>.5&&setTimeout((()=>{this.panningAccelerationLoop()}),20)},pingpoliCandlestickChart.prototype.click=function(t){var i=(t=>{var i=this.canvas.getBoundingClientRect();return{x:t.clientX-i.left,y:t.clientY-i.top}})(t);if(this.marketPriceRect.b_clickable&&i.x>this.marketPriceRect.x&&i.x<this.marketPriceRect.x+this.marketPriceRect.width&&i.y>this.marketPriceRect.y&&i.y<this.marketPriceRect.y+this.marketPriceRect.height)return this.scrollOffsetX=0,this.scrollOffsetXCounter=0,void this.draw();if(1==t.ctrlKey){let t=parseFloat(this.yToValueCoords(i.y));2==t.toString().split(".").length&&t.toString().split(".")[1].length>6&&(t=t.toFixed(6)),0==isNaN(t)&&$.ajax({url:"/set_notify",method:"POST",data:{sybmol:this.ticker.toUpperCase(),price:t},success:function(t){renderNotifications(t),window.notify=t}})}"click"===this.options.overlayMode&&(this.b_drawMouseOverlay?(this.b_drawMouseOverlay=!1,this.draw()):this.updateOverlay(t))},pingpoliCandlestickChart.prototype.updateOverlay=function(t){if(this.mousePosition=(t=>{var i=this.canvas.getBoundingClientRect();return{x:t.clientX-i.left,y:t.clientY-i.top}})(t),this.mousePosition.x+=this.candleWidth/2,this.b_drawMouseOverlay=!0,this.mousePosition.x<this.marginLeft&&(this.b_drawMouseOverlay=!1),this.mousePosition.x>this.width-this.marginRight+this.candleWidth&&(this.b_drawMouseOverlay=!1),this.mousePosition.y>this.height-this.marginBottom&&(this.b_drawMouseOverlay=!1),this.b_drawMouseOverlay){this.yMouseHover=this.yToValueCoords(this.mousePosition.y),this.overlayPriceValue=this.yMouseHover.toFixed(6),this.xMouseHover=this.xToValueCoords(this.mousePosition.x);var i=this.candlesticks[1].timestamp-this.candlesticks[0].timestamp;this.hoveredCandlestickID=Math.floor((this.xMouseHover-this.candlesticks[0].timestamp)/i),this.xMouseHover=Math.floor(this.xMouseHover/i)*i,this.mousePosition.x=this.xToPixelCoords(this.xMouseHover),this.draw()}else this.draw()},pingpoliCandlestickChart.prototype.moveOverlay=function(t){this.b_drawMouseOverlay&&(this.b_moveOverlay=!0,this.draw())},pingpoliCandlestickChart.prototype.limitScrollOffset=function(){if(this.zoomStartID+this.scrollOffsetX<0&&(this.scrollOffsetX=-this.zoomStartID,this.scrollOffsetXCounter=-this.zoomStartID,Date.now()>this.panningAtStartCooldown&&(this.panningAtStartCallback(),this.panningAtStartCooldown=Date.now()+1e3)),this.options.allowOverPanning){var t=this.candlesticks.length-this.zoomStartID;this.scrollOffsetX>Math.floor(t/2)&&(this.scrollOffsetX=Math.floor(t/2),this.scrollOffsetXCounter=Math.floor(t/2),Date.now()>this.panningAtEndCooldown&&(this.panningAtEndCallback(),this.panningAtEndCooldown=Date.now()+1e3))}else this.scrollOffsetX>0&&(this.scrollOffsetX=0,this.scrollOffsetXCounter=0,Date.now()>this.panningAtEndCooldown&&(this.panningAtEndCallback(),this.panningAtEndCooldown=Date.now()+1e3))},pingpoliCandlestickChart.prototype.draw=function(){if(this.context.clearRect(0,0,this.width,this.height),this.context.font=this.options.fontSize+"px "+this.options.font,null!==this.watermarkImage&&this.b_watermarkImageLoaded){var t=.5*(this.width-this.watermarkImage.width),i=.5*(this.height-this.watermarkImage.height);this.context.drawImage(this.watermarkImage,t,i)}if(0!=this.candlesticks.length){this.b_firstDraw&&(this.zoomStartID=this.candlesticks.length-200,this.zoomStartID<0&&(this.zoomStartID=0),this.scrollOffsetX=0,this.scrollOffsetXCounter=0,this.b_firstDraw=!1),this.calculateYRange(),this.calculateXRange(),!1===this.options.disableGrid&&this.drawGrid(),this.candleWidth=Math.floor(this.xPixelRange/(this.candlesticks.length-this.zoomStartID)),this.candleWidth--,this.candleWidth%2==0&&this.candleWidth--;for(var s=!1,e=this.zoomStartID+this.scrollOffsetX;e<this.candlesticks.length+this.scrollOffsetX;++e){if(e>=this.candlesticks.length)continue;e==this.candlesticks.length-1&&(s=!0);var o=this.candlesticks[e].close>this.candlesticks[e].open?this.options.wickGreenColor:this.options.wickRedColor;this.context.lineWidth=this.options.wickWidth,this.drawLine(Math.floor(this.xToPixelCoords(this.candlesticks[e].timestamp)),Math.floor(this.yToPixelCoords(this.candlesticks[e].low)),Math.floor(this.xToPixelCoords(this.candlesticks[e].timestamp)),Math.floor(this.yToPixelCoords(this.candlesticks[e].high)),o),o=this.candlesticks[e].close>this.candlesticks[e].open?this.greenColor:this.redColor,e==this.hoveredCandlestickID&&(o==this.greenColor?o=this.greenHoverColor:o==this.redColor&&(o=this.redHoverColor));let t=this.candlesticks[e].close;this.candlesticks[e].open==this.candlesticks[e].close&&(t=this.candlesticks[e].open+1e-5*this.candlesticks[e].open),this.fillRect(Math.floor(this.xToPixelCoords(this.candlesticks[e].timestamp))-Math.floor(this.candleWidth/2),Math.floor(this.yToPixelCoords(this.candlesticks[e].open)),this.candleWidth,Math.floor(this.yToPixelCoords(t)-this.yToPixelCoords(this.candlesticks[e].open)),o),this.options.candleBorderWidth>0&&(o=this.candlesticks[e].close>this.candlesticks[e].open?this.options.wickGreenColor:this.options.wickRedColor,this.context.lineWidth=this.options.candleBorderWidth,this.drawRect(Math.floor(this.xToPixelCoords(this.candlesticks[e].timestamp))-Math.floor(this.candleWidth/2),Math.floor(this.yToPixelCoords(this.candlesticks[e].open)),this.candleWidth,Math.floor(this.yToPixelCoords(t)-this.yToPixelCoords(this.candlesticks[e].open)),o),this.context.lineWidth=1)}if(this.context.lineWidth=1,!1===this.options.disableLegend&&this.drawLegend(),!1===this.options.disableLowHighPriceDisplay){this.context.fillStyle=this.gridTextColor;var h=this.context.measureText(this.yEnd).width,n=Math.floor(this.xToPixelCoords(this.candlesticks[this.yEndIndex].timestamp));n+h+20>this.width?(n-=h+20,this.drawLine(n+h+5,Math.floor(this.yToPixelCoords(this.yEnd)),n+h+20-1,Math.floor(this.yToPixelCoords(this.yEnd)),this.gridTextColor),this.context.fillText(this.yEnd,n,Math.floor(this.yToPixelCoords(this.yEnd))+this.options.fontSize/2)):(this.drawLine(n+1,Math.floor(this.yToPixelCoords(this.yEnd)),n+15,Math.floor(this.yToPixelCoords(this.yEnd)),this.gridTextColor),this.context.fillText(this.yEnd,n+20,Math.floor(this.yToPixelCoords(this.yEnd))+this.options.fontSize/2));var a=this.context.measureText(this.yStart).width,r=Math.floor(this.xToPixelCoords(this.candlesticks[this.yStartIndex].timestamp));r+a+20>this.width?(r-=a+20,this.drawLine(r+a+5,Math.floor(this.yToPixelCoords(this.yStart)),r+a+20-1,Math.floor(this.yToPixelCoords(this.yStart)),this.gridTextColor),this.context.fillText(this.yStart,r,Math.floor(this.yToPixelCoords(this.yStart))+this.options.fontSize/2)):(this.drawLine(r+1,Math.floor(this.yToPixelCoords(this.yStart)),r+15,Math.floor(this.yToPixelCoords(this.yStart)),this.gridTextColor),this.context.fillText(this.yStart,r+20,Math.floor(this.yToPixelCoords(this.yStart))+this.options.fontSize/2))}if(!1===this.options.disableCurrentMarketPrice){var l=this.candlesticks[this.candlesticks.length-1].close;if(this.context.setLineDash([2,2]),s){this.drawLine(this.xToPixelCoords(this.candlesticks[this.candlesticks.length-1].timestamp)+this.candleWidth,this.yToPixelCoords(l),this.width,this.yToPixelCoords(l),this.options.marketPriceLineColor);o=this.candlesticks[this.candlesticks.length-1].close>this.candlesticks[this.candlesticks.length-1].open?this.greenColor:this.redColor;var c=this.context.measureText(l).width;this.fillRect(this.width-c-10,this.yToPixelCoords(l)-this.options.fontSize/2-2,c+10,this.options.fontSize+4,o),this.context.fillStyle=this.options.marketPriceTextColor,this.context.fillText(l,this.width-c-5,this.yToPixelCoords(l)+this.options.fontSize/2-2),this.marketPriceRect.b_clickable=!1}else{var d=l+" >";c=this.context.measureText(d).width;if(l>this.yEnd){var p=this.width-this.width/2-c,g=20;this.drawLine(p,g,p+100,g,this.options.marketPriceLineColor),this.drawLine(p+100,g,p+100,0,this.options.marketPriceLineColor),this.fillRect(p-10,g-this.options.fontSize/2-2,c+10,this.options.fontSize+4,this.options.marketPriceLineColor),this.context.fillStyle=this.options.marketPriceTextColor,this.context.fillText(d,p-5,g+this.options.fontSize/2-2),this.marketPriceRect.x=p-10,this.marketPriceRect.y=g-this.options.fontSize/2-2,this.marketPriceRect.width=c+10,this.marketPriceRect.height=this.options.fontSize+4,this.marketPriceRect.b_clickable=!0}else if(l<this.yStart){p=this.width-this.width/2-c,g=this.height-this.marginBottom;this.drawLine(p,g,p+100,g,this.options.marketPriceLineColor),this.drawLine(p+100,g,p+100,this.height,this.options.marketPriceLineColor),this.fillRect(p-10,g-this.options.fontSize/2-2,c+10,this.options.fontSize+4,this.options.marketPriceLineColor),this.context.fillStyle=this.options.marketPriceTextColor,this.context.fillText(d,p-5,g+this.options.fontSize/2-2),this.marketPriceRect.x=p-10,this.marketPriceRect.y=g-this.options.fontSize/2-2,this.marketPriceRect.width=c+10,this.marketPriceRect.height=this.options.fontSize+4,this.marketPriceRect.b_clickable=!0}else this.drawLine(0,this.yToPixelCoords(l),this.width,this.yToPixelCoords(l),this.options.marketPriceLineColor),this.fillRect(this.width-this.width/2-c-10,this.yToPixelCoords(l)-this.options.fontSize/2-2,c+10,this.options.fontSize+4,this.options.marketPriceLineColor),this.context.fillStyle=this.options.marketPriceTextColor,this.context.fillText(d,this.width-this.width/2-c-5,this.yToPixelCoords(l)+this.options.fontSize/2-2),this.marketPriceRect.x=this.width-this.width/2-c-10,this.marketPriceRect.y=this.yToPixelCoords(l)-this.options.fontSize/2-2,this.marketPriceRect.width=c+10,this.marketPriceRect.height=this.options.fontSize+4,this.marketPriceRect.b_clickable=!0}this.context.setLineDash([])}if(this.b_drawMouseOverlay){if(this.b_moveOverlay&&(this.mousePosition.x=this.xToPixelCoords(this.xMouseHover),this.mousePosition.y=this.yToPixelCoords(this.overlayPriceValue),this.b_moveOverlay=!1),!1===this.options.disableCrosshair){"dashed"==this.options.crosshairLineStyle?this.context.setLineDash([5,5]):"dotted"==this.options.crosshairLineStyle?this.context.setLineDash([2,2]):this.context.setLineDash([]),this.drawLine(0,this.mousePosition.y,this.width,this.mousePosition.y,this.options.crosshairColor);d=this.overlayPriceValue,c=this.context.measureText(d).width;this.fillRect(this.width-c-10,this.mousePosition.y-this.options.fontSize/2-2,c+10,this.options.fontSize+4,this.options.crosshairColor),this.context.fillStyle=this.options.crosshairTextColor,this.context.fillText(d,this.width-c-5,this.mousePosition.y+this.options.fontSize/2-2),this.drawLine(this.mousePosition.x,0,this.mousePosition.x,this.height,this.options.crosshairColor),d=this.formatDate(new Date(this.xMouseHover)),c=this.context.measureText(d).width,this.fillRect(this.mousePosition.x-c/2-5,this.height-this.options.fontSize-5,c+10,this.options.fontSize+5,this.options.crosshairColor),this.context.fillStyle=this.options.crosshairTextColor,this.context.fillText(d,this.mousePosition.x-c/2,this.height-5),this.context.setLineDash([])}if(this.hoveredCandlestickID>=0&&this.hoveredCandlestickID<this.candlesticks.length){var f=0,x=10;if(this.options.overlayShowTime){var m=this.formatDate(new Date(this.xMouseHover));this.context.measureText(m).width>f&&(f=this.context.measureText(m).width),x+=this.options.fontSize}if(this.options.overlayShowData){var C="Open: "+this.candlesticks[this.hoveredCandlestickID].open;this.context.measureText(C).width>f&&(f=this.context.measureText(C).width);var y="High: "+this.candlesticks[this.hoveredCandlestickID].high;this.context.measureText(y).width>f&&(f=this.context.measureText(y).width);var v="Low: "+this.candlesticks[this.hoveredCandlestickID].low;this.context.measureText(v).width>f&&(f=this.context.measureText(v).width);var k="Close: "+this.candlesticks[this.hoveredCandlestickID].close;this.context.measureText(k).width>f&&(f=this.context.measureText(k).width),x+=4*this.options.fontSize}if(this.options.overlayShowChange){var w=0,u=0;this.hoveredCandlestickID>0&&(w=this.candlesticks[this.hoveredCandlestickID].close-this.candlesticks[this.hoveredCandlestickID-1].close,u=(w=Math.abs(w)>1?Math.round(100*w)/100:Math.abs(w)>.01?w.toFixed(4):Math.abs(w)>1e-4?w.toFixed(6):w.toFixed(8))/this.candlesticks[this.hoveredCandlestickID-1].close*100,u=Math.round(100*u)/100);var S="Change: "+w;this.context.measureText(S).width>f&&(f=this.context.measureText(S).width);var P="Change %: "+u+"%";this.context.measureText(P).width>f&&(f=this.context.measureText(P).width),x+=2*this.options.fontSize}var T=(f+=20)+10+10;(g=this.mousePosition.y-x-15)<0&&(g=this.mousePosition.y+15),(p=this.mousePosition.x+15)+T>this.width&&(p=this.mousePosition.x-T-15),this.fillRect(p,g,T,x,this.overlayBackgroundColor);o=this.candlesticks[this.hoveredCandlestickID].close>this.candlesticks[this.hoveredCandlestickID].open?this.greenColor:this.redColor;this.fillRect(p,g,10,x,o),this.context.lineWidth=2,this.drawRect(p,g,T,x,o),this.context.lineWidth=1,this.context.fillStyle=this.overlayTextColor;var D=g+this.options.fontSize;this.options.overlayShowTime&&(this.context.fillText(m,p+15,D),D+=this.options.fontSize),this.options.overlayShowData&&(this.context.fillText("Open:",p+15,D),this.context.fillText(this.candlesticks[this.hoveredCandlestickID].open,p+T-this.context.measureText(this.candlesticks[this.hoveredCandlestickID].open).width-5,D),D+=this.options.fontSize,this.context.fillText("High:",p+15,D),this.context.fillText(this.candlesticks[this.hoveredCandlestickID].high,p+T-this.context.measureText(this.candlesticks[this.hoveredCandlestickID].high).width-5,D),D+=this.options.fontSize,this.context.fillText("Low:",p+15,D),this.context.fillText(this.candlesticks[this.hoveredCandlestickID].low,p+T-this.context.measureText(this.candlesticks[this.hoveredCandlestickID].low).width-5,D),D+=this.options.fontSize,this.context.fillText("Close:",p+15,D),this.context.fillText(this.candlesticks[this.hoveredCandlestickID].close,p+T-this.context.measureText(this.candlesticks[this.hoveredCandlestickID].close).width-5,D),D+=this.options.fontSize),this.options.overlayShowChange&&(this.context.fillText("Change:",p+15,D),this.context.fillText(w,p+T-this.context.measureText(w).width-5,D),D+=this.options.fontSize,this.context.fillText("Change %:",p+15,D),this.context.fillText(u+"%",p+T-this.context.measureText(u+"%").width-5,D),D+=this.options.fontSize)}}}},pingpoliCandlestickChart.prototype.drawGrid=function(){"dashed"==this.options.gridLineStyle?this.context.setLineDash([5,5]):"dotted"==this.options.gridLineStyle?this.context.setLineDash([2,2]):this.context.setLineDash([]);var t=this.yRange/this.yGridCells,i=Math.pow(10,Math.ceil(Math.log10(t)));t<.25*i?i*=.25:t<.5*i&&(i*=.5);for(var s=Math.ceil(this.yStart/i)*i,e=Math.floor(this.yEnd/i)*i,o=s;o<=e;o+=i)this.drawLine(0,this.yToPixelCoords(o),this.width,this.yToPixelCoords(o),this.gridColor);var h=this.xRange/this.xGridCells;h<.25*(i=Math.pow(10,Math.ceil(Math.log10(h))))?i*=.25:h<.5*i&&(i*=.5);var n=Math.ceil(this.xStart/i)*i,a=Math.floor(this.xEnd/i)*i;this.xRange;for(var r=n;r<=a;r+=i)this.drawLine(this.xToPixelCoords(r),0,this.xToPixelCoords(r),this.height,this.gridColor);this.context.setLineDash([])},pingpoliCandlestickChart.prototype.drawLegend=function(){var t=this.yRange/this.yGridCells,i=Math.pow(10,Math.ceil(Math.log10(t)));t<.25*i?i*=.25:t<.5*i&&(i*=.5);for(var s=Math.ceil(this.yStart/i)*i,e=Math.floor(this.yEnd/i)*i,o=s;o<=e;o+=i){var h=this.context.measureText(this.roundPriceValue(o)).width;this.context.fillStyle=this.gridTextColor,this.context.fillText(this.roundPriceValue(o),this.width-h-5,this.yToPixelCoords(o)-5)}var n=this.xRange/this.xGridCells;i=Math.pow(10,Math.ceil(Math.log10(n))),window.innerWidth<=300&&(i*=1.1),window.innerWidth<=600?i*=1.05:n<.25*i?i*=.25:n<.5*i&&(i*=.5);var a=Math.ceil(this.xStart/i)*i,r=Math.floor(this.xEnd/i)*i,l=!1;this.xRange>864e5&&(l=!0);for(var c=a;c<=r;c+=i){var d=new Date(c),p="";if(l){var g=d.getDate();g<10&&(g="0"+g);var f=d.getMonth()+1;f<10&&(f="0"+f),p=g+"."+f}else{var x=d.getMinutes();x<10&&(x="0"+x),p=d.getHours()+":"+x}this.context.fillStyle=this.gridTextColor,this.context.fillText(p,this.xToPixelCoords(c)+5,this.height-5)}},pingpoliCandlestickChart.prototype.calculateYRange=function(){for(var t=this.zoomStartID+this.scrollOffsetX;t<this.candlesticks.length+this.scrollOffsetX;++t)t>=this.candlesticks.length||(t==this.zoomStartID+this.scrollOffsetX?(this.yStart=this.candlesticks[t].low,this.yEnd=this.candlesticks[t].high):(this.candlesticks[t].low<this.yStart&&(this.yStart=this.candlesticks[t].low,this.yStartIndex=t),this.candlesticks[t].high>this.yEnd&&(this.yEnd=this.candlesticks[t].high,this.yEndIndex=t)));this.yRange=this.yEnd-this.yStart},pingpoliCandlestickChart.prototype.calculateXRange=function(){if(0==this.candlesticks.length)this.xStart=0,this.xEnd=0,this.xRange=0;else if(this.scrollOffsetX>0){var t=this.candlesticks[1].timestamp-this.candlesticks[0].timestamp;this.xStart=this.candlesticks[this.zoomStartID+this.scrollOffsetX].timestamp;var i=this.scrollOffsetX;i>0&&(i=0),this.xEnd=this.candlesticks[this.candlesticks.length-1+i].timestamp,this.xEnd+=this.scrollOffsetX*t,this.xRange=this.xEnd-this.xStart}else this.xStart=this.candlesticks[this.zoomStartID+this.scrollOffsetX].timestamp,this.xEnd=this.candlesticks[this.candlesticks.length-1+this.scrollOffsetX].timestamp,this.xRange=this.xEnd-this.xStart},pingpoliCandlestickChart.prototype.yToPixelCoords=function(t){return this.height-this.marginBottom-(t-this.yStart)*this.yPixelRange/this.yRange},pingpoliCandlestickChart.prototype.xToPixelCoords=function(t){return this.marginLeft+(t-this.xStart)*this.xPixelRange/this.xRange},pingpoliCandlestickChart.prototype.yToValueCoords=function(t){return this.yStart+(this.height-this.marginBottom-t)*this.yRange/this.yPixelRange},pingpoliCandlestickChart.prototype.xToValueCoords=function(t){return this.xStart+(t-this.marginLeft)*this.xRange/this.xPixelRange},pingpoliCandlestickChart.prototype.drawLine=function(t,i,s,e,o){this.context.beginPath(),this.context.lineWidth%2==0?(this.context.moveTo(t,i),this.context.lineTo(s,e)):(this.context.moveTo(t+.5,i+.5),this.context.lineTo(s+.5,e+.5)),this.context.strokeStyle=o,this.context.stroke()},pingpoliCandlestickChart.prototype.fillRect=function(t,i,s,e,o){this.context.beginPath(),this.context.fillStyle=o,this.context.rect(t,i,s,e),this.context.fill()},pingpoliCandlestickChart.prototype.drawRect=function(t,i,s,e,o){this.context.beginPath(),this.context.strokeStyle=o,this.context.rect(t,i,s,e),this.context.stroke()},pingpoliCandlestickChart.prototype.formatDate=function(t){var i=t.getDate();i<10&&(i="0"+i);var s=t.getMonth()+1;s<10&&(s="0"+s);var e=t.getHours();e<10&&(e="0"+e);var o=t.getMinutes();return o<10&&(o="0"+o),i+"."+s+"."+t.getFullYear()+" - "+e+":"+o},pingpoliCandlestickChart.prototype.roundPriceValue=function(t){return t>1?Math.round(100*t)/100:t>.001?Math.round(1e3*t)/1e3:t>1e-5?Math.round(1e5*t)/1e5:t>1e-7?Math.round(1e7*t)/1e7:Math.round(1e9*t)/1e9};let chart_options={disableGrid:!0,disablePanningAcceleration:!0,backgroundColor:"transparent",greenColor:"#58BD7D",greenHoverColor:"#58BD7D",redColor:"#FF6838",redHoverColor:"#FF6838",fillWidth:!0,fillHeight:!0};function CandlestickStream(t,i){this.symbol=t,this.interval=i,this.candlestickChart=new pingpoliCandlestickChart("trade_chart",chart_options),_candlestickStream=this}CandlestickStream.prototype.start=function(t){_candlestickStream.candlestickChart.setTicker(this.symbol),_candlestickStream.candlestickChart.clear();for(var i=0;i<t.length;++i)_candlestickStream.candlestickChart.addCandlestick(t[i][0],t[i][1],t[i][2],t[i][3],t[i][4]);return _candlestickStream.candlestickChart.draw(),!0};